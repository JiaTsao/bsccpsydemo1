<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è«®å•†é†«ç™‚å¾Œå°ç®¡ç†ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.3.0/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            text-align: center;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .nav-tab.active {
            background: linear-gradient(45deg, #764ba2, #667eea);
            transform: translateY(-2px);
        }
        
        .content-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
        }
        
        .client-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }
        
        .client-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-bar input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 16px;
            background: white;
        }
        
        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        
        .calendar-day {
            padding: 10px;
            text-align: center;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .calendar-day:hover {
            background: #f8f9ff;
            border-color: #667eea;
        }
        
        .calendar-day.booked {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .calendar-day.available {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .time-slot {
            padding: 8px 16px;
            text-align: center;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .time-slot:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .time-slot.booked {
            background: #ffebee;
            border-color: #ff6b6b;
            color: #d32f2f;
            cursor: not-allowed;
        }
        
        .time-slot.selected {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #667eea;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1.1rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success {
            background: linear-gradient(45deg, #51cf66, #40c057);
        }
        
        .notification.error {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // æ¨¡æ“¬ Firebase é…ç½®ï¼ˆå¯¦éš›éƒ¨ç½²æ™‚éœ€è¦æ›¿æ›ç‚ºçœŸå¯¦é…ç½®ï¼‰
        const firebaseConfig = {
            // é€™è£¡éœ€è¦å¡«å…¥æ‚¨çš„ Firebase é…ç½®
            // æš«æ™‚ä½¿ç”¨æœ¬åœ°å­˜å„²æ¨¡æ“¬æ•¸æ“šåº«åŠŸèƒ½
        };

        // æ¨¡æ“¬æ•¸æ“šå­˜å„²
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    return initialValue;
                }
            });

            const setValue = (value) => {
                try {
                    setStoredValue(value);
                    window.localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.error(error);
                }
            };

            return [storedValue, setValue];
        };

        // é€šçŸ¥çµ„ä»¶
        const Notification = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className={`notification ${type}`}>
                    {message}
                </div>
            );
        };

        const Login = ({ onLogin, users }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                const user = users.find(
                    (u) => u.username === username && u.password === password
                );
                if (user) {
                    onLogin(user);
                } else {
                    setError('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
                }
            };

            return (
                <div className="content-section">
                    <h2>ç™»å…¥</h2>
                    <form onSubmit={handleLogin}>
                        <div className="form-group">
                            <label>å¸³è™Ÿ</label>
                            <input
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                required
                            />
                        </div>
                        <div className="form-group">
                            <label>å¯†ç¢¼</label>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                        </div>
                        {error && (
                            <p style={{ color: 'red', marginBottom: '10px' }}>{error}</p>
                        )}
                        <button type="submit" className="btn btn-primary">ç™»å…¥</button>
                    </form>
                </div>
            );
        };

        // å€‹æ¡ˆç®¡ç†çµ„ä»¶
        const ClientManagement = ({ clients, setClients, showNotification }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [showModal, setShowModal] = useState(false);
            const [editingClient, setEditingClient] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                gender: '',
                age: '',
                phone: '',
                email: '',
                complaint: '',
                notes: '',
                record: ''
            });

            const filteredClients = clients.filter(client =>
                client.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                client.phone.includes(searchTerm) ||
                client.complaint.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingClient) {
                    setClients(clients.map(client =>
                        client.id === editingClient.id
                            ? { ...formData, id: editingClient.id }
                            : client
                    ));
                    showNotification('å€‹æ¡ˆè³‡æ–™å·²æ›´æ–°', 'success');
                } else {
                    const newClient = {
                        ...formData,
                        id: Date.now(),
                        createdAt: new Date().toLocaleDateString('zh-TW')
                    };
                    setClients([...clients, newClient]);
                    showNotification('å€‹æ¡ˆè³‡æ–™å·²æ–°å¢', 'success');
                }
                
                setFormData({
                    name: '',
                    gender: '',
                    age: '',
                    phone: '',
                    email: '',
                    complaint: '',
                    notes: '',
                    record: ''
                });
                setEditingClient(null);
                setShowModal(false);
            };

            const handleEdit = (client) => {
                setEditingClient(client);
                setFormData({ ...client, record: client.record || '' });
                setShowModal(true);
            };

            const handleDelete = (id) => {
                if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å€‹æ¡ˆè³‡æ–™å—ï¼Ÿ')) {
                    setClients(clients.filter(client => client.id !== id));
                    showNotification('å€‹æ¡ˆè³‡æ–™å·²åˆªé™¤', 'success');
                }
            };

            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                        <h2>å€‹æ¡ˆè³‡æ–™ç®¡ç†</h2>
                        <button className="btn btn-primary" onClick={() => setShowModal(true)}>
                            æ–°å¢å€‹æ¡ˆ
                        </button>
                    </div>

                    <div className="search-bar">
                        <input
                            type="text"
                            placeholder="æœå°‹å€‹æ¡ˆå§“åã€é›»è©±æˆ–ä¸»è¨´..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                        <span className="search-icon">ğŸ”</span>
                    </div>

                    <div>
                        {filteredClients.map(client => (
                            <div key={client.id} className="client-card">
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                                    <div style={{ flex: 1 }}>
                                        <h3 style={{ color: '#667eea', marginBottom: '8px' }}>{client.name}</h3>
                                        <p><strong>æ€§åˆ¥ï¼š</strong>{client.gender} | <strong>å¹´é½¡ï¼š</strong>{client.age}æ­²</p>
                                        <p><strong>é›»è©±ï¼š</strong>{client.phone}</p>
                                        <p><strong>Emailï¼š</strong>{client.email}</p>
                                        <p><strong>ä¸»è¨´ï¼š</strong>{client.complaint}</p>
                                        {client.notes && <p><strong>å‚™è¨»ï¼š</strong>{client.notes}</p>}
                                        {client.record && <p><strong>ç´€éŒ„ï¼š</strong>{client.record}</p>}
                                        <p style={{ color: '#666', fontSize: '0.9rem', marginTop: '10px' }}>
                                            å»ºç«‹æ—¥æœŸï¼š{client.createdAt}
                                        </p>
                                    </div>
                                    <div>
                                        <button className="btn btn-primary" onClick={() => handleEdit(client)}>
                                            ç·¨è¼¯
                                        </button>
                                        <button className="btn btn-danger" onClick={() => handleDelete(client.id)}>
                                            åˆªé™¤
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {showModal && (
                        <div className="modal" onClick={() => setShowModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <h3>{editingClient ? 'ç·¨è¼¯å€‹æ¡ˆ' : 'æ–°å¢å€‹æ¡ˆ'}</h3>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-row">
                                        <div className="form-group">
                                            <label>å§“å *</label>
                                            <input
                                                type="text"
                                                required
                                                value={formData.name}
                                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>æ€§åˆ¥ *</label>
                                            <select
                                                required
                                                value={formData.gender}
                                                onChange={(e) => setFormData({...formData, gender: e.target.value})}
                                            >
                                                <option value="">è«‹é¸æ“‡</option>
                                                <option value="ç”·">ç”·</option>
                                                <option value="å¥³">å¥³</option>
                                                <option value="å…¶ä»–">å…¶ä»–</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="form-row">
                                        <div className="form-group">
                                            <label>å¹´é½¡ *</label>
                                            <input
                                                type="number"
                                                required
                                                min="1"
                                                max="120"
                                                value={formData.age}
                                                onChange={(e) => setFormData({...formData, age: e.target.value})}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>é›»è©± *</label>
                                            <input
                                                type="tel"
                                                required
                                                value={formData.phone}
                                                onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                    <div className="form-group">
                                        <label>Email</label>
                                        <input
                                            type="email"
                                            value={formData.email}
                                            onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>ä¸»è¨´ *</label>
                                        <textarea
                                            required
                                            rows="3"
                                            value={formData.complaint}
                                            onChange={(e) => setFormData({...formData, complaint: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>å‚™è¨»</label>
                                        <textarea
                                            rows="3"
                                            value={formData.notes}
                                            onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label>ç—…æ­·/è«®å•†ç´€éŒ„</label>
                                        <textarea
                                            rows="3"
                                            value={formData.record}
                                            onChange={(e) => setFormData({...formData, record: e.target.value})}
                                        />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end' }}>
                                        <button type="button" className="btn" onClick={() => setShowModal(false)}>
                                            å–æ¶ˆ
                                        </button>
                                        <button type="submit" className="btn btn-primary">
                                            {editingClient ? 'æ›´æ–°' : 'æ–°å¢'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // å ´åœ°é ç´„çµ„ä»¶
        const VenueBooking = ({ bookings, setBookings, clients, psychologists, venues, showNotification }) => {
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [selectedTime, setSelectedTime] = useState('');
            const [selectedClient, setSelectedClient] = useState('');
            const [selectedPsych, setSelectedPsych] = useState('');
            const [selectedVenue, setSelectedVenue] = useState(venues[0] || '');
            const [fee, setFee] = useState(2000);
            const [paid, setPaid] = useState(false);
            const [online, setOnline] = useState(false);
            const [notes, setNotes] = useState('');
            const [currentMonth, setCurrentMonth] = useState(new Date());

            const timeSlots = [
                '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', 
                '15:00', '16:00', '17:00', '18:00', '19:00', '20:00'
            ];

            const getDaysInMonth = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startDay = firstDay.getDay();

                const days = [];
                for (let i = 0; i < startDay; i++) {
                    days.push(null);
                }
                for (let i = 1; i <= daysInMonth; i++) {
                    days.push(new Date(year, month, i));
                }
                return days;
            };

            const isTimeSlotBooked = (date, time, venue) => {
                return bookings.some(booking =>
                    booking.date === date && booking.time === time && booking.venue === venue
                );
            };

            const getBookingsForDate = (date) => {
                return bookings.filter(booking => booking.date === date);
            };

            const handleBooking = (e) => {
                e.preventDefault();
                if (!selectedDate || !selectedTime || !selectedClient) {
                    showNotification('è«‹å¡«å¯«æ‰€æœ‰å¿…è¦è³‡è¨Š', 'error');
                    return;
                }

                if (isTimeSlotBooked(selectedDate, selectedTime, selectedVenue)) {
                    showNotification('æ­¤æ™‚æ®µå·²è¢«é ç´„', 'error');
                    return;
                }

                const client = clients.find(c => c.id.toString() === selectedClient);
                const psych = psychologists.find(p => p.id.toString() === selectedPsych);
                const newBooking = {
                    id: Date.now(),
                    date: selectedDate,
                    time: selectedTime,
                    clientId: selectedClient,
                    clientName: client?.name || '',
                    psychologistId: selectedPsych,
                    psychologistName: psych?.name || '',
                    venue: selectedVenue,
                    fee: Number(fee),
                    paid: paid,
                    videoLink: online ? `https://meet.example.com/${Date.now()}` : '',
                    notes: notes,
                    status: 'å·²é ç´„',
                    createdAt: new Date().toLocaleString('zh-TW')
                };

                setBookings([...bookings, newBooking]);
                showNotification('é ç´„å·²æˆåŠŸå»ºç«‹', 'success');
                
                // æ¸…ç©ºè¡¨å–®
                setSelectedTime('');
                setSelectedClient('');
                setSelectedPsych('');
                setNotes('');
                setPaid(false);
                setOnline(false);
            };

            const handleCancelBooking = (bookingId) => {
                if (confirm('ç¢ºå®šè¦å–æ¶ˆæ­¤é ç´„å—ï¼Ÿ')) {
                    setBookings(bookings.filter(booking => booking.id !== bookingId));
                    showNotification('é ç´„å·²å–æ¶ˆ', 'success');
                }
            };

            const days = getDaysInMonth(currentMonth);
            const monthNames = [
                'ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ',
                'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'
            ];

            return (
                <div>
                    <h2>å ´åœ°é ç´„ç®¡ç†</h2>
                    
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '30px', marginTop: '20px' }}>
                        {/* é ç´„è¡¨å–® */}
                        <div className="content-section">
                            <h3>æ–°å¢é ç´„</h3>
                            <form onSubmit={handleBooking}>
                                <div className="form-group">
                                    <label>é¸æ“‡æ—¥æœŸ *</label>
                                    <input
                                        type="date"
                                        required
                                        value={selectedDate}
                                        onChange={(e) => setSelectedDate(e.target.value)}
                                        min={new Date().toISOString().split('T')[0]}
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label>é¸æ“‡æ™‚æ®µ *</label>
                                    <div className="time-slots">
                                        {timeSlots.map(time => (
                                            <div
                                                key={time}
                                                className={`time-slot ${
                                                    isTimeSlotBooked(selectedDate, time, selectedVenue) ? 'booked' : ''
                                                } ${selectedTime === time ? 'selected' : ''}`}
                                                onClick={() => {
                                                    if (!isTimeSlotBooked(selectedDate, time, selectedVenue)) {
                                                        setSelectedTime(time);
                                                    }
                                                }}
                                            >
                                                {time}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="form-group">
                                    <label>é¸æ“‡å€‹æ¡ˆ *</label>
                                    <select
                                        required
                                        value={selectedClient}
                                        onChange={(e) => setSelectedClient(e.target.value)}
                                    >
                                        <option value="">è«‹é¸æ“‡å€‹æ¡ˆ</option>
                                        {clients.map(client => (
                                            <option key={client.id} value={client.id}>
                                                {client.name} - {client.phone}
                                            </option>
                                        ))}
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label>é¸æ“‡å¿ƒç†å¸« *</label>
                                    <select
                                        required
                                        value={selectedPsych}
                                        onChange={(e) => setSelectedPsych(e.target.value)}
                                    >
                                        <option value="">è«‹é¸æ“‡å¿ƒç†å¸«</option>
                                        {psychologists.map(p => (
                                            <option key={p.id} value={p.id}>{p.name}</option>
                                        ))}
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label>é¸æ“‡å ´åœ° *</label>
                                    <select
                                        required
                                        value={selectedVenue}
                                        onChange={(e) => setSelectedVenue(e.target.value)}
                                    >
                                        {venues.map(v => (
                                            <option key={v} value={v}>{v}</option>
                                        ))}
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label>è²»ç”¨</label>
                                    <input type="number" value={fee} onChange={(e)=>setFee(e.target.value)} />
                                </div>

                                <div className="form-group">
                                    <label>
                                        <input type="checkbox" checked={paid} onChange={(e)=>setPaid(e.target.checked)} /> å·²æ”¶è²»
                                    </label>
                                </div>

                                <div className="form-group">
                                    <label>
                                        <input type="checkbox" checked={online} onChange={(e)=>setOnline(e.target.checked)} /> ç·šä¸Šè«®å•†
                                    </label>
                                </div>

                                <div className="form-group">
                                    <label>å‚™è¨»</label>
                                    <textarea
                                        rows="3"
                                        value={notes}
                                        onChange={(e) => setNotes(e.target.value)}
                                        placeholder="é ç´„ç›¸é—œå‚™è¨»..."
                                    />
                                </div>

                                <button type="submit" className="btn btn-primary">
                                    ç¢ºèªé ç´„
                                </button>
                            </form>
                        </div>

                        {/* ç•¶æ—¥é ç´„åˆ—è¡¨ */}
                        <div className="content-section">
                            <h3>{selectedDate} çš„é ç´„</h3>
                            <div>
                                {getBookingsForDate(selectedDate).length === 0 ? (
                                    <p style={{ textAlign: 'center', color: '#666', padding: '20px' }}>
                                        æ­¤æ—¥æœŸå°šç„¡é ç´„
                                    </p>
                                ) : (
                                    getBookingsForDate(selectedDate).map(booking => (
                                        <div key={booking.id} className="client-card">
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                <div>
                                                    <h4 style={{ color: '#667eea' }}>{booking.time}</h4>
                                                    <p><strong>å€‹æ¡ˆï¼š</strong>{booking.clientName}</p>
                                                    <p><strong>å¿ƒç†å¸«ï¼š</strong>{booking.psychologistName}</p>
                                                    <p><strong>å ´åœ°ï¼š</strong>{booking.venue}</p>
                                                    <p><strong>ç‹€æ…‹ï¼š</strong>{booking.status}</p>
                                                    <p><strong>è²»ç”¨ï¼š</strong>NT$ {booking.fee}</p>
                                                    <p><strong>å·²æ”¶è²»ï¼š</strong>{booking.paid ? 'æ˜¯' : 'å¦'}</p>
                                                    {booking.notes && <p><strong>å‚™è¨»ï¼š</strong>{booking.notes}</p>}
                                                </div>
                                                <button 
                                                    className="btn btn-danger"
                                                    onClick={() => handleCancelBooking(booking.id)}
                                                >
                                                    å–æ¶ˆé ç´„
                                                </button>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>

                    {/* æœˆæ›†è¦–åœ– */}
                    <div className="content-section" style={{ marginTop: '30px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <button 
                                className="btn btn-primary"
                                onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))}
                            >
                                â† ä¸Šå€‹æœˆ
                            </button>
                            <h3>{currentMonth.getFullYear()}å¹´ {monthNames[currentMonth.getMonth()]}</h3>
                            <button 
                                className="btn btn-primary"
                                onClick={() => setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1))}
                            >
                                ä¸‹å€‹æœˆ â†’
                            </button>
                        </div>
                        
                        <div className="calendar-grid">
                            <div style={{ fontWeight: 'bold', textAlign: 'center', padding: '10px' }}>æ—¥</div>
                            <div style={{ fontWeight: 'bold', textAlign: 'center', padding: '10px' }}>ä¸€</div>
                            <div style={{ fontWeight: 'bold', textAlign: 'center', padding: '10px' }}>äºŒ</div>
                            <div style={{ fontWeight: 'bold', textAlign: 'center', padding: '10px' }}>ä¸‰</div>
                            <div style={{ fontWeight: 'bold', textAlign: 'center', padding: '10px' }}>å››</div>
                            <div style={{ fontWeight: 'bold', textAlign: 'center', padding: '10px' }}>äº”</div>
                            <div style={{ fontWeight: 'bold', textAlign: 'center', padding: '10px' }}>å…­</div>
                            
                            {days.map((day, index) => {
                                if (!day) return <div key={index}></div>;
                                
                                const dateStr = day.toISOString().split('T')[0];
                                const hasBookings = getBookingsForDate(dateStr).length > 0;
                                
                                return (
                                    <div 
                                        key={index}
                                        className={`calendar-day ${hasBookings ? 'booked' : 'available'}`}
                                        onClick={() => setSelectedDate(dateStr)}
                                        style={{ 
                                            background: selectedDate === dateStr ? '#667eea' : hasBookings ? '#ff6b6b' : '#51cf66',
                                            color: 'white'
                                        }}
                                    >
                                        <div>{day.getDate()}</div>
                                        {hasBookings && (
                                            <div style={{ fontSize: '0.8rem', marginTop: '2px' }}>
                                                {getBookingsForDate(dateStr).length} é ç´„
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // é€šçŸ¥ç³»çµ±çµ„ä»¶
        const NotificationSystem = ({ bookings, clients, showNotification }) => {
            const [notifications, setNotifications] = useState([]);

            useEffect(() => {
                // æ¨¡æ“¬é€šçŸ¥ç”Ÿæˆ
                const generateNotifications = () => {
                    const today = new Date().toISOString().split('T')[0];
                    const todayBookings = bookings.filter(booking => booking.date === today);
                    
                    return todayBookings.map(booking => ({
                        id: booking.id,
                        type: 'appointment',
                        title: 'ä»Šæ—¥é ç´„æé†’',
                        message: `${booking.clientName} é ç´„æ™‚é–“ï¼š${booking.time}`,
                        time: new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' })
                    }));
                };

                setNotifications(generateNotifications());
            }, [bookings]);

            const sendTestNotification = () => {
                // æ¨¡æ“¬ç™¼é€é›»å­éƒµä»¶é€šçŸ¥
                showNotification('æ¸¬è©¦é€šçŸ¥å·²ç™¼é€', 'success');
            };

            return (
                <div>
                    <h2>é€šçŸ¥ç³»çµ±</h2>
                    
                    <div className="content-section">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h3>ä»Šæ—¥é€šçŸ¥</h3>
                            <button className="btn btn-primary" onClick={sendTestNotification}>
                                ç™¼é€æ¸¬è©¦é€šçŸ¥
                            </button>
                        </div>
                        
                        {notifications.length === 0 ? (
                            <p style={{ textAlign: 'center', color: '#666', padding: '20px' }}>
                                ä»Šæ—¥æš«ç„¡é€šçŸ¥
                            </p>
                        ) : (
                            notifications.map(notification => (
                                <div key={notification.id} className="client-card">
                                    <h4 style={{ color: '#667eea', marginBottom: '8px' }}>
                                        {notification.title}
                                    </h4>
                                    <p>{notification.message}</p>
                                    <p style={{ color: '#666', fontSize: '0.9rem', marginTop: '8px' }}>
                                        æ™‚é–“ï¼š{notification.time}
                                    </p>
                                </div>
                            ))
                        )}
                        
                        <div style={{ marginTop: '30px' }}>
                            <h4>é€šçŸ¥è¨­å®š</h4>
                            <div className="form-group">
                                <label>
                                    <input type="checkbox" defaultChecked /> 
                                    é›»å­éƒµä»¶é€šçŸ¥
                                </label>
                            </div>
                            <div className="form-group">
                                <label>
                                    <input type="checkbox" defaultChecked /> 
                                    é ç´„å‰ 24 å°æ™‚æé†’
                                </label>
                            </div>
                            <div className="form-group">
                                <label>
                                    <input type="checkbox" defaultChecked /> 
                                    é ç´„å‰ 2 å°æ™‚æé†’
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const PsychologistManagement = ({ psychologists, bookings }) => {
            const getStats = (psych) => {
                const psychBookings = bookings.filter(b => b.psychologistId === psych.id);
                const clients = [...new Set(psychBookings.map(b => b.clientId))];
                const retained = clients.filter(cid => psychBookings.filter(b => b.clientId === cid).length > 1);
                const rate = clients.length > 0 ? Math.round((retained.length / clients.length) * 100) : 0;
                return { cases: clients.length, rate };
            };

            return (
                <div>
                    <h2>å¿ƒç†å¸«ç®¡ç†</h2>
                    {psychologists.map(psych => {
                        const s = getStats(psych);
                        return (
                            <div key={psych.id} className="client-card">
                                <h3 style={{ color: '#667eea', marginBottom: '8px' }}>{psych.name}</h3>
                                <p><strong>ç›®å‰å€‹æ¡ˆæ•¸ï¼š</strong>{s.cases}</p>
                                <p><strong>ç•™æ¡ˆç‡ï¼š</strong>{s.rate}%</p>
                            </div>
                        );
                    })}
                </div>
            );
        };

        // çµ±è¨ˆåˆ†æçµ„ä»¶
        const StatisticsAnalysis = ({ clients, bookings }) => {
            const chartRef = useRef(null);
            const pieChartRef = useRef(null);
            const chartInstanceRef = useRef(null);
            const pieChartInstanceRef = useRef(null);

            const exportCSV = () => {
                const headers = ['æ—¥æœŸ','æ™‚é–“','å€‹æ¡ˆ','å¿ƒç†å¸«','å ´åœ°','è²»ç”¨','å·²æ”¶è²»'];
                const rows = bookings.map(b => [b.date, b.time, b.clientName, b.psychologistName, b.venue, b.fee, b.paid ? 'æ˜¯' : 'å¦']);
                const csvContent = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'bookings.csv';
                link.click();
                URL.revokeObjectURL(url);
            };

            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const totalClients = clients.length;
            const totalBookings = bookings.length;
            const thisMonthBookings = bookings.filter(booking => {
                const bookingDate = new Date(booking.date);
                const thisMonth = new Date();
                return bookingDate.getMonth() === thisMonth.getMonth() && 
                       bookingDate.getFullYear() === thisMonth.getFullYear();
            }).length;

            // è¨ˆç®—ç•™æ¡ˆç‡ï¼ˆæ¨¡æ“¬æ•¸æ“šï¼‰
            const retentionRate = totalClients > 0 ? Math.round((thisMonthBookings / totalClients) * 100) : 0;

            // è²»ç”¨è¨ˆç®—
            const sessionFee = 2000; // æ¯æ¬¡æœƒè«‡è²»ç”¨
            const totalRevenue = bookings.reduce((acc, b) => acc + (Number(b.fee) || sessionFee), 0);
            const thisMonthRevenue = bookings.filter(b => {
                const d = new Date(b.date);
                const m = new Date();
                return d.getMonth() === m.getMonth() && d.getFullYear() === m.getFullYear();
            }).reduce((acc, b) => acc + (Number(b.fee) || sessionFee), 0);

            useEffect(() => {
                // æœˆåº¦é ç´„è¶¨å‹¢åœ–
                if (chartRef.current) {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                        chartInstanceRef.current = null;
                    }
                    const ctx = chartRef.current.getContext('2d');
                    
                    // ç”Ÿæˆéå»6å€‹æœˆçš„æ•¸æ“š
                    const months = [];
                    const bookingCounts = [];
                    
                    for (let i = 5; i >= 0; i--) {
                        const date = new Date();
                        date.setMonth(date.getMonth() - i);
                        months.push(date.toLocaleDateString('zh-TW', { month: 'short' }));
                        
                        // æ¨¡æ“¬æ•¸æ“š
                        bookingCounts.push(Math.floor(Math.random() * 20) + 5);
                    }

                    chartInstanceRef.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: months,
                            datasets: [{
                                label: 'é ç´„æ¬¡æ•¸',
                                data: bookingCounts,
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'æœˆåº¦é ç´„è¶¨å‹¢'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }

                // æ€§åˆ¥åˆ†å¸ƒåœ“é¤…åœ–
                if (pieChartRef.current) {
                    if (pieChartInstanceRef.current) {
                        pieChartInstanceRef.current.destroy();
                        pieChartInstanceRef.current = null;
                    }
                    const ctx = pieChartRef.current.getContext('2d');
                    
                    const genderCount = clients.reduce((acc, client) => {
                        acc[client.gender] = (acc[client.gender] || 0) + 1;
                        return acc;
                    }, {});

                    pieChartInstanceRef.current = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(genderCount),
                            datasets: [{
                                data: Object.values(genderCount),
                                backgroundColor: [
                                    '#667eea',
                                    '#764ba2',
                                    '#51cf66',
                                    '#ff6b6b'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'å€‹æ¡ˆæ€§åˆ¥åˆ†å¸ƒ'
                                }
                            }
                        }
                    });
                }

                return () => {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                        chartInstanceRef.current = null;
                    }
                    if (pieChartInstanceRef.current) {
                        pieChartInstanceRef.current.destroy();
                        pieChartInstanceRef.current = null;
                    }
                };
            }, [clients, bookings]);

            return (
                <div>
                    <h2>çµ±è¨ˆåˆ†æ</h2>
                    
                    {/* çµ±è¨ˆå¡ç‰‡ */}
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-number">{totalClients}</div>
                            <div className="stat-label">ç¸½å€‹æ¡ˆæ•¸</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{totalBookings}</div>
                            <div className="stat-label">ç¸½é ç´„æ¬¡æ•¸</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{thisMonthBookings}</div>
                            <div className="stat-label">æœ¬æœˆé ç´„</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{retentionRate}%</div>
                            <div className="stat-label">ç•™æ¡ˆç‡</div>
                        </div>
                    </div>

                    {/* ç‡Ÿæ”¶çµ±è¨ˆ */}
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-number">NT$ {totalRevenue.toLocaleString()}</div>
                            <div className="stat-label">ç¸½ç‡Ÿæ”¶</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">NT$ {thisMonthRevenue.toLocaleString()}</div>
                            <div className="stat-label">æœ¬æœˆç‡Ÿæ”¶</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">NT$ {sessionFee.toLocaleString()}</div>
                            <div className="stat-label">å–®æ¬¡è²»ç”¨</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{totalClients > 0 ? Math.round(totalBookings / totalClients) : 0}</div>
                            <div className="stat-label">å¹³å‡é ç´„æ¬¡æ•¸</div>
                        </div>
                    </div>

                    {/* åœ–è¡¨ */}
                    <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr', gap: '20px', marginTop: '30px' }}>
                        <div className="chart-container">
                            <canvas ref={chartRef}></canvas>
                        </div>
                        <div className="chart-container">
                            <canvas ref={pieChartRef}></canvas>
                        </div>
                    </div>

                    {/* è©³ç´°å ±è¡¨ */}
                    <div className="content-section" style={{ marginTop: '30px' }}>
                        <h3>é ç´„è©³ç´°è¨˜éŒ„</h3>
                        <button className="btn btn-primary" onClick={exportCSV} style={{ marginBottom: '10px' }}>
                            åŒ¯å‡º CSV
                        </button>
                        <div style={{ overflowX: 'auto' }}>
                            <table style={{ width: '100%', borderCollapse: 'collapse', marginTop: '20px' }}>
                                <thead>
                                    <tr style={{ backgroundColor: '#f8f9ff' }}>
                                        <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #667eea' }}>æ—¥æœŸ</th>
                                        <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #667eea' }}>æ™‚é–“</th>
                                        <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #667eea' }}>å€‹æ¡ˆå§“å</th>
                                        <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #667eea' }}>å¿ƒç†å¸«</th>
                                        <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #667eea' }}>å ´åœ°</th>
                                        <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #667eea' }}>ç‹€æ…‹</th>
                                        <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #667eea' }}>è²»ç”¨</th>
                                        <th style={{ padding: '12px', textAlign: 'left', borderBottom: '2px solid #667eea' }}>å·²æ”¶è²»</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {bookings.slice(0, 10).map(booking => (
                                        <tr key={booking.id}>
                                            <td style={{ padding: '12px', borderBottom: '1px solid #eee' }}>{booking.date}</td>
                                            <td style={{ padding: '12px', borderBottom: '1px solid #eee' }}>{booking.time}</td>
                                            <td style={{ padding: '12px', borderBottom: '1px solid #eee' }}>{booking.clientName}</td>
                                            <td style={{ padding: '12px', borderBottom: '1px solid #eee' }}>{booking.psychologistName}</td>
                                            <td style={{ padding: '12px', borderBottom: '1px solid #eee' }}>{booking.venue}</td>
                                            <td style={{ padding: '12px', borderBottom: '1px solid #eee' }}>
                                                <span style={{
                                                    padding: '4px 8px',
                                                    borderRadius: '12px',
                                                    backgroundColor: '#e8f5e8',
                                                    color: '#2e7d32',
                                                    fontSize: '0.9rem'
                                                }}>
                                                    {booking.status}
                                                </span>
                                            </td>
                                            <td style={{ padding: '12px', borderBottom: '1px solid #eee' }}>NT$ {booking.fee}</td>
                                            <td style={{ padding: '12px', borderBottom: '1px solid #eee' }}>{booking.paid ? 'æ˜¯' : 'å¦'}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        // å€‹äººé ç´„(å€‹æ¡ˆ)é¡¯ç¤º
        const MyBookings = ({ bookings, user }) => {
            const my = bookings.filter(b => b.clientName === user.name);
            return (
                <div>
                    <h2>æˆ‘çš„é ç´„</h2>
                    {my.length === 0 ? (
                        <p style={{ textAlign: 'center', color: '#666' }}>å°šç„¡é ç´„</p>
                    ) : (
                        my.map(b => (
                            <div key={b.id} className="client-card">
                                <p><strong>æ—¥æœŸï¼š</strong>{b.date}</p>
                                <p><strong>æ™‚é–“ï¼š</strong>{b.time}</p>
                                <p><strong>å ´åœ°ï¼š</strong>{b.venue}</p>
                                <p><strong>å¿ƒç†å¸«ï¼š</strong>{b.psychologistName}</p>
                            </div>
                        ))
                    )}
                </div>
            );
        };

        // å¿ƒç†å¸«é ç´„åˆ—è¡¨åŠå¸³è™Ÿè¨­å®š
        const TherapistSchedule = ({ bookings, user }) => {
            const my = bookings.filter(b => b.psychologistName === user.name);
            return (
                <div>
                    <h2>é ç´„åˆ—è¡¨</h2>
                    {my.length === 0 ? (
                        <p style={{ textAlign: 'center', color: '#666' }}>å°šç„¡é ç´„</p>
                    ) : (
                        my.map(b => (
                            <div key={b.id} className="client-card">
                                <p><strong>æ—¥æœŸï¼š</strong>{b.date}</p>
                                <p><strong>æ™‚é–“ï¼š</strong>{b.time}</p>
                                <p><strong>å€‹æ¡ˆï¼š</strong>{b.clientName}</p>
                                <p><strong>å ´åœ°ï¼š</strong>{b.venue}</p>
                            </div>
                        ))
                    )}
                </div>
            );
        };

        const TherapistProfile = ({ user, setUsers, users, onUpdate }) => {
            const [name, setName] = useState(user.name);
            const [password, setPassword] = useState(user.password);
            const handleSave = e => {
                e.preventDefault();
                const updated = { ...user, name, password };
                setUsers(users.map(u => (u.id === user.id ? updated : u)));
                onUpdate(updated);
            };
            return (
                <form onSubmit={handleSave} className="content-section">
                    <h3>å¸³è™Ÿè¨­å®š</h3>
                    <div className="form-group">
                        <label>å§“å</label>
                        <input value={name} onChange={e => setName(e.target.value)} />
                    </div>
                    <div className="form-group">
                        <label>å¯†ç¢¼</label>
                        <input type="password" value={password} onChange={e => setPassword(e.target.value)} />
                    </div>
                    <button type="submit" className="btn btn-primary">å„²å­˜</button>
                </form>
            );
        };

        // ç®¡ç†å“¡ç”¨æˆ¶è¨­å®š
        const ManageUsers = ({ users, setUsers }) => {
            const empty = { id: null, name: '', username: '', password: '', role: 'client' };
            const [form, setForm] = useState(empty);

            const handleSubmit = e => {
                e.preventDefault();
                if (form.id) {
                    setUsers(users.map(u => (u.id === form.id ? form : u)));
                } else {
                    setUsers([...users, { ...form, id: Date.now() }]);
                }
                setForm(empty);
            };

            const handleEdit = u => setForm(u);
            const handleDelete = id => {
                if (confirm('ç¢ºå®šåˆªé™¤?')) setUsers(users.filter(u => u.id !== id));
            };

            return (
                <div className="content-section">
                    <h3>ä½¿ç”¨è€…è³‡è¨Šè¨­å®š</h3>
                    <form onSubmit={handleSubmit} style={{ marginBottom: '20px' }}>
                        <div className="form-group">
                            <label>å§“å</label>
                            <input value={form.name} onChange={e => setForm({ ...form, name: e.target.value })} required />
                        </div>
                        <div className="form-group">
                            <label>å¸³è™Ÿ</label>
                            <input value={form.username} onChange={e => setForm({ ...form, username: e.target.value })} required />
                        </div>
                        <div className="form-group">
                            <label>å¯†ç¢¼</label>
                            <input value={form.password} onChange={e => setForm({ ...form, password: e.target.value })} required />
                        </div>
                        <div className="form-group">
                            <label>è§’è‰²</label>
                            <select value={form.role} onChange={e => setForm({ ...form, role: e.target.value })}>
                                <option value="admin">ç®¡ç†å“¡</option>
                                <option value="therapist">å¿ƒç†å¸«</option>
                                <option value="client">å€‹æ¡ˆ</option>
                            </select>
                        </div>
                        <button type="submit" className="btn btn-primary">{form.id ? 'æ›´æ–°' : 'æ–°å¢'}</button>
                    </form>
                    {users.map(u => (
                        <div key={u.id} className="client-card" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div>
                                <p><strong>{u.name}</strong> ({u.role})</p>
                                <p>{u.username}</p>
                            </div>
                            <div>
                                <button className="btn btn-primary" onClick={() => handleEdit(u)}>ç·¨è¼¯</button>
                                <button className="btn btn-danger" onClick={() => handleDelete(u.id)}>åˆªé™¤</button>
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        const ManageVenues = ({ venues, setVenues }) => {
            const [newVenue, setNewVenue] = useState('');
            const add = () => {
                if (!newVenue) return;
                setVenues([...venues, newVenue]);
                setNewVenue('');
            };
            const remove = v => {
                if (confirm('ç¢ºå®šåˆªé™¤?')) setVenues(venues.filter(x => x !== v));
            };
            return (
                <div className="content-section">
                    <h3>å ´åœ°è¨­å®š</h3>
                    <div className="form-group" style={{ display: 'flex', gap: '10px' }}>
                        <input value={newVenue} onChange={e => setNewVenue(e.target.value)} placeholder="æ–°å¢å ´åœ°" />
                        <button type="button" className="btn btn-primary" onClick={add}>æ–°å¢</button>
                    </div>
                    {venues.map(v => (
                        <div key={v} className="client-card" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <span>{v}</span>
                            <button className="btn btn-danger" onClick={() => remove(v)}>åˆªé™¤</button>
                        </div>
                    ))}
                </div>
            );
        };

        const AdminSettings = ({ users, setUsers, venues, setVenues }) => (
            <div>
                <ManageVenues venues={venues} setVenues={setVenues} />
                <ManageUsers users={users} setUsers={setUsers} />
            </div>
        );

        // ä¸»æ‡‰ç”¨ç¨‹å¼çµ„ä»¶
        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('');
            const [clients, setClients] = useLocalStorage('clients', []);
            const [bookings, setBookings] = useLocalStorage('bookings', []);
            const [psychologists, setPsychologists] = useLocalStorage('psychologists', []);
            const [users, setUsers] = useLocalStorage('users', []);
            const [venues, setVenues] = useLocalStorage('venues', []);
            const [notification, setNotification] = useState(null);

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
            };

            const closeNotification = () => {
                setNotification(null);
            };

            // åˆå§‹åŒ–ç¤ºä¾‹æ•¸æ“š
            useEffect(() => {
                if (users.length === 0) {
                    const sampleUsers = [
                        { id: 1, username: 'admin', password: 'admin123', role: 'admin', name: 'ç®¡ç†å“¡' },
                        { id: 2, username: 'therapist', password: 'therapist123', role: 'therapist', name: 'å¼µå¿ƒç†å¸«' },
                        { id: 3, username: 'client', password: 'client123', role: 'client', name: 'ç‹å°æ˜' }
                    ];
                    setUsers(sampleUsers);
                }

                if (venues.length === 0) {
                    setVenues(['è«®å•†å®¤A', 'è«®å•†å®¤B', 'è«®å•†å®¤C']);
                }

                if (clients.length === 0) {
                    const sampleClients = [
                        {
                            id: 1,
                            name: 'ç‹å°æ˜',
                            gender: 'ç”·',
                            age: '28',
                            phone: '0912-345-678',
                            email: 'wang@example.com',
                            complaint: 'å·¥ä½œå£“åŠ›éå¤§ï¼Œç¶“å¸¸å¤±çœ ',
                            notes: 'éœ€è¦å£“åŠ›ç®¡ç†æŠ€å·§',
                            record: '',
                            createdAt: '2024/12/15'
                        },
                        {
                            id: 2,
                            name: 'æå°è¯',
                            gender: 'å¥³',
                            age: '32',
                            phone: '0923-456-789',
                            email: 'li@example.com',
                            complaint: 'äººéš›é—œä¿‚å›°æ“¾',
                            notes: 'èˆ‡åŒäº‹ç›¸è™•æœ‰å›°é›£',
                            record: '',
                            createdAt: '2024/12/10'
                        }
                    ];
                    setClients(sampleClients);
                }

                if (psychologists.length === 0) {
                    const sampleTherapists = [
                        { id: 1, name: 'å¼µå¿ƒç†å¸«' },
                        { id: 2, name: 'é™³å¿ƒç†å¸«' }
                    ];
                    setPsychologists(sampleTherapists);
                }

                if (bookings.length === 0) {
                    const today = new Date();
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    
                    const sampleBookings = [
                        {
                            id: 1,
                            date: today.toISOString().split('T')[0],
                            time: '14:00',
                            clientId: '1',
                            clientName: 'ç‹å°æ˜',
                            venue: 'è«®å•†å®¤A',
                            psychologistId: 1,
                            psychologistName: 'å¼µå¿ƒç†å¸«',
                            fee: 2000,
                            paid: true,
                            videoLink: '',
                            notes: 'ç¬¬äºŒæ¬¡æœƒè«‡',
                            status: 'å·²é ç´„',
                            createdAt: new Date().toLocaleString('zh-TW')
                        },
                        {
                            id: 2,
                            date: tomorrow.toISOString().split('T')[0],
                            time: '16:00',
                            clientId: '2',
                            clientName: 'æå°è¯',
                            venue: 'è«®å•†å®¤B',
                            psychologistId: 2,
                            psychologistName: 'é™³å¿ƒç†å¸«',
                            fee: 2000,
                            paid: false,
                            videoLink: '',
                            notes: 'åˆæ¬¡æœƒè«‡',
                            status: 'å·²é ç´„',
                            createdAt: new Date().toLocaleString('zh-TW')
                        }
                    ];
                    setBookings(sampleBookings);
                }
            }, []);

            const tabs = React.useMemo(() => {
                if (!currentUser) return [];
                if (currentUser.role === 'admin') {
                    return [
                        { id: 'clients', label: 'å€‹æ¡ˆç®¡ç†', icon: 'ğŸ‘¤' },
                        { id: 'booking', label: 'å ´åœ°é ç´„', icon: 'ğŸ“…' },
                        { id: 'therapists', label: 'å¿ƒç†å¸«ç®¡ç†', icon: 'ğŸ§‘â€âš•ï¸' },
                        { id: 'notifications', label: 'é€šçŸ¥ç³»çµ±', icon: 'ğŸ””' },
                        { id: 'statistics', label: 'çµ±è¨ˆåˆ†æ', icon: 'ğŸ“Š' },
                        { id: 'settings', label: 'ç³»çµ±è¨­å®š', icon: 'âš™ï¸' }
                    ];
                }
                if (currentUser.role === 'therapist') {
                    return [
                        { id: 'schedule', label: 'é ç´„åˆ—è¡¨', icon: 'ğŸ“…' },
                        { id: 'profile', label: 'å¸³è™Ÿè¨­å®š', icon: 'ğŸ‘¤' }
                    ];
                }
                return [{ id: 'my', label: 'æˆ‘çš„é ç´„', icon: 'ğŸ“…' }];
            }, [currentUser]);

            useEffect(() => {
                if (tabs.length && !tabs.find(t => t.id === activeTab)) {
                    setActiveTab(tabs[0].id);
                }
            }, [tabs]);

            if (!currentUser) {
                return <Login onLogin={setCurrentUser} users={users} />;
            }

            return (
                <div className="container">
                    {notification && (
                        <Notification
                            message={notification.message}
                            type={notification.type}
                            onClose={closeNotification}
                        />
                    )}

                    <div className="header">
                        <h1>è«®å•†é†«ç™‚å¾Œå°ç®¡ç†ç³»çµ±</h1>
                        <p style={{ textAlign: 'center', color: '#666', marginTop: '10px' }}>
                            å°ˆæ¥­çš„å€‹æ¡ˆç®¡ç†èˆ‡é ç´„ç³»çµ±
                        </p>
                        
                        <div className="nav-tabs">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    className={`nav-tab ${activeTab === tab.id ? 'active' : ''}`}
                                    onClick={() => setActiveTab(tab.id)}
                                >
                                    <span style={{ marginRight: '8px' }}>{tab.icon}</span>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="content-section">
                        {currentUser.role === 'admin' && activeTab === 'clients' && (
                            <ClientManagement
                                clients={clients}
                                setClients={setClients}
                                showNotification={showNotification}
                            />
                        )}

                        {currentUser.role === 'admin' && activeTab === 'booking' && (
                            <VenueBooking
                                bookings={bookings}
                                setBookings={setBookings}
                                clients={clients}
                                psychologists={psychologists}
                                venues={venues}
                                showNotification={showNotification}
                            />
                        )}

                        {currentUser.role === 'admin' && activeTab === 'therapists' && (
                            <PsychologistManagement psychologists={psychologists} bookings={bookings} />
                        )}

                        {currentUser.role === 'admin' && activeTab === 'notifications' && (
                            <NotificationSystem
                                bookings={bookings}
                                clients={clients}
                                showNotification={showNotification}
                            />
                        )}

                        {currentUser.role === 'admin' && activeTab === 'statistics' && (
                            <StatisticsAnalysis
                                clients={clients}
                                bookings={bookings}
                            />
                        )}

                        {currentUser.role === 'admin' && activeTab === 'settings' && (
                            <AdminSettings users={users} setUsers={setUsers} venues={venues} setVenues={setVenues} />
                        )}

                        {currentUser.role === 'client' && activeTab === 'my' && (
                            <MyBookings bookings={bookings} user={currentUser} />
                        )}

                        {currentUser.role === 'therapist' && activeTab === 'schedule' && (
                            <TherapistSchedule bookings={bookings} user={currentUser} />
                        )}

                        {currentUser.role === 'therapist' && activeTab === 'profile' && (
                            <TherapistProfile user={currentUser} users={users} setUsers={setUsers} onUpdate={setCurrentUser} />
                        )}
                    </div>
                </div>
            );
        };

        // æ¸²æŸ“æ‡‰ç”¨ç¨‹å¼
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
